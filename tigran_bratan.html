<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CleanKst PRO</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0061ff;
            --primary-grad: linear-gradient(135deg, #0061ff 0%, #60efff 100%);
            --bg: #f8f9fa; --white: #ffffff; --text: #1c1e21; --gray: #65676b;
            --success: #00b894; --danger: #d63031; --warning: #fdcb6e;
            --shadow: 0 12px 30px rgba(0,0,0,0.06);
        }

        * { box-sizing: border-box; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: #cfd8dc; display: flex; justify-content: center; }

        .app-shell { width: 100%; max-width: 430px; height: 100vh; background: var(--bg); position: relative; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.2); }
        
        .screen { display: none; flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 100px; scroll-behavior: smooth; }
        .screen.active { display: flex; flex-direction: column; animation: fadeIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* UI Elements */
        .card { background: var(--white); border-radius: 24px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.5); }
        
        .btn { width: 100%; padding: 18px; border-radius: 18px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .btn-p { background: var(--primary-grad); color: white; box-shadow: 0 8px 20px rgba(0, 97, 255, 0.25); }
        .btn-ghost { background: #eff2f5; color: var(--text); }
        
        input, select, textarea { width: 100%; padding: 15px; border: 1px solid #e0e0e0; border-radius: 16px; margin-top: 8px; font-size: 14px; background: #fdfdfd; font-weight: 500; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); background: #fff; box-shadow: 0 0 0 4px rgba(0, 97, 255, 0.1); }
        label { font-size: 11px; font-weight: 800; color: var(--gray); margin-top: 15px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }

        .price-display { font-size: 30px; font-weight: 800; color: var(--primary); text-align: center; margin: 15px 0; letter-spacing: -1px; }

        /* Admin Status Dots */
        .status-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .dot-green { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .dot-red { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
        .dot-yellow { background: var(--warning); box-shadow: 0 0 8px var(--warning); }

        /* Tabs */
        .tabs { display: flex; background: #e0e0e0; border-radius: 16px; padding: 4px; margin-bottom: 20px; }
        .tab { flex: 1; text-align: center; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 12px; font-weight: 700; color: #666; transition: 0.3s; }
        .tab.active { background: var(--white); color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (Dark Glass) */
        .debug-bar { 
            position: absolute; bottom: 20px; left: 20px; right: 20px;
            background: rgba(28, 30, 33, 0.95); /* –¢–µ–º–Ω–∞—è –æ—Å–Ω–æ–≤–∞ */
            backdrop-filter: blur(12px);
            padding: 10px; border-radius: 30px; display: flex; justify-content: space-around; z-index: 1000;
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .debug-item { 
            color: rgba(255,255,255,0.5); 
            font-size: 9px; text-align: center; cursor: pointer; transition: 0.3s; width: 50px; 
        }
        
        .debug-item i { 
            font-size: 18px; margin-bottom: 4px; display: block; 
        }
        
        .debug-item.active { 
            color: var(--white); 
            transform: translateY(-2px); 
        }
        
        .debug-item.active i { 
            color: var(--accent); /* –ù–∞—à —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π –∂–µ–ª—Ç—ã–π */
            text-shadow: 0 0 12px rgba(255, 214, 0, 0.6); /* –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è */
        }
    </style>
</head>
<body>

<div class="app-shell">

    <div id="scr-login" class="screen active">
        <div style="text-align:center; padding: 60px 0 40px;">
            <div style="width: 80px; height: 80px; background: var(--primary-grad); border-radius: 26px; margin: 0 auto; display: flex; align-items: center; justify-content: center; box-shadow: 0 20px 40px rgba(0,97,255,0.3);">
                <i class="fas fa-gem" style="color: white; font-size: 36px;"></i>
            </div>
            <h1 style="margin: 20px 0 5px; font-weight: 800; font-size: 26px;">CleanKst <span style="color:var(--primary)">PRO</span></h1>
            <p style="color: var(--gray); font-size: 13px; font-weight: 500;">–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–Ω–∏–Ω–≥–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –ö–æ—Å—Ç–∞–Ω–∞—è</p>
        </div>
        <div class="card">
            <label>–î–æ—Å—Ç—É–ø</label>
            <input type="text" id="log-user" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ –ª–æ–≥–∏–Ω">
            <label>–ü–∞—Ä–æ–ª—å</label>
            <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button class="btn btn-p" style="margin-top: 25px;" onclick="handleAuth()">–í–æ–π—Ç–∏</button>
            <button class="btn btn-ghost" style="margin-top: 10px;" onclick="nav('scr-reg')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
    </div>

    <div id="scr-reg" class="screen">
        <h2 style="font-weight: 800; margin-bottom: 5px;">–ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç</h2>
        <p style="color: var(--gray); font-size: 13px; margin-bottom: 20px;">–°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∑–∞ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥</p>
        <div class="card">
            <label>–ò–º—è</label><input type="text" placeholder="–ë–æ–≥–¥–∞–Ω">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" placeholder="+7 707...">
            <label>–ü–∞—Ä–æ–ª—å</label><input type="password">
            <button class="btn btn-p" style="margin-top: 25px;" onclick="alert('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω!'); nav('scr-login')">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button class="btn btn-ghost" style="margin-top: 10px;" onclick="nav('scr-login')">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <div id="scr-client" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <div>
                <p style="font-size:11px; font-weight:700; color:var(--gray); margin:0;">–≥. –ö–æ—Å—Ç–∞–Ω–∞–π</p>
                <h2 style="margin:0; font-weight:800;">–ü—Ä–∏–≤–µ—Ç, –ë–æ–≥–¥–∞–Ω!</h2>
            </div>
            <div onclick="logout()" style="background:white; width:40px; height:40px; border-radius:14px; display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow); cursor:pointer;"><i class="fas fa-sign-out-alt" style="color:#d63031;"></i></div>
        </div>
        
        <div class="card" style="border-left: 4px solid var(--primary);">
            <label>–ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞</label>
            <input type="text" id="c-addr" value="–ø—Ä. –ù—É—Ä—Å—É–ª—Ç–∞–Ω–∞ –ù–∞–∑–∞—Ä–±–∞–µ–≤–∞, 239">
            
            <label>–¢–∏–ø –ø–æ–º–µ—â–µ–Ω–∏—è</label>
            <select id="c-type" onchange="calcPrice()">
		<option value="10000">–°—Ç—É–¥–∏—è (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                <option value="12000">1-–∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                <option value="18000">2-–∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                <option value="25000">3-–∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
                <option value="CUSTOM">–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç</option>
            </select>

            <div id="standard-block">
                <label>–£—Å–ª—É–≥–∞</label>
                <select id="c-srv" onchange="calcPrice()">
                    <option value="1">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è</option>
                    <option value="1.6">–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è (x1.6)</option>
                    <option value="2.5">–ü–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞ (x2.5)</option>
                </select>
            </div>

            <label>–î–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
            <textarea id="c-info" rows="2" placeholder="–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–∞, –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞..."></textarea>

            <div class="price-display" id="c-total">12 000 ‚Ç∏</div>
            
            <button class="btn btn-p" id="btn-order-text" onclick="createOrder()">
                <span>–ó–∞–∫–∞–∑–∞—Ç—å</span> <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <h4 style="margin-left:10px; margin-bottom:10px;">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h4>
        <div id="client-history"></div>
    </div>

    <div id="scr-admin" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0; font-weight:800;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <span style="font-size:10px; background:#dff9fb; color:#130f40; padding:5px 10px; border-radius:10px; font-weight:700;">ONLINE</span>
        </div>
        
        <div class="card">
            <h4 style="margin:0 0 15px 0;">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—Ä–∏–≥–∞–¥</h4>
            <div id="brigades-monitor">
                </div>
        </div>

        <h4 style="margin-left: 10px; margin-bottom: 10px;">–í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏</h4>
        <div id="admin-orders"></div>
        
        <div style="text-align:center; margin-top:20px;">
            <button class="btn btn-ghost" onclick="resetApp()" style="width:auto; font-size:11px; padding:10px 20px;">üóë –°–±—Ä–æ—Å –±–∞–∑—ã</button>
        </div>
    </div>

    <div id="scr-brig" class="screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <div>
                <h2 style="margin:0; font-weight:800;">–ê–±–ª–∞–π</h2>
                <p style="margin:0; font-size:11px; color:var(--gray);">–ë—Ä–∏–≥–∞–¥–∞ ‚Ññ1</p>
            </div>
            <div onclick="logout()" style="cursor:pointer;"><i class="fas fa-sign-out-alt"></i></div>
        </div>

        <div class="tabs">
            <div class="tab active" id="t-obj" onclick="brTab('obj')">–û–±—ä–µ–∫—Ç</div>
            <div class="tab" id="t-prof" onclick="brTab('prof')">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <div id="br-obj-view">
            <div id="br-active-job"></div>
        </div>

        <div id="br-prof-view" style="display:none;">
            <div class="card">
                <h4 style="margin-top:0;">–ú–æ—è –∫–æ–º–∞–Ω–¥–∞</h4>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; padding:10px; background:#f8f9fa; border-radius:12px;">
                    <div style="width:30px; height:30px; background:#fab1a0; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px;">–í</div>
                    <div><b>–í–∞–¥–∏–º</b><br><small>–ö–ª–∏–Ω–µ—Ä</small></div>
                </div>
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; padding:10px; background:#f8f9fa; border-radius:12px;">
                    <div style="width:30px; height:30px; background:#74b9ff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px;">–¢</div>
                    <div><b>–¢–ª–µ–≥–µ–Ω</b><br><small>–ö–ª–∏–Ω–µ—Ä</small></div>
                </div>
                <div style="background:#fff0f0; border:1px solid #ff7675; padding:15px; border-radius:16px; color:#d63031; text-align:center;">
                    –®—Ç—Ä–∞—Ñ—ã: <b>0 ‚Ç∏</b>
                </div>
            </div>
        </div>
    </div>

    <div id="scr-worker" class="screen">
        <h2 style="font-weight:800; margin-bottom:20px;">–ó–∞–¥–∞—á–∏: –í–∞–¥–∏–º</h2>
        <div id="worker-tasks"></div>
    </div>

    <div class="debug-bar">
        <div class="debug-item active" onclick="nav('scr-login')" data-id="scr-login"><i class="fas fa-lock"></i>–í—Ö–æ–¥</div>
        <div class="debug-item" onclick="nav('scr-client')" data-id="scr-client"><i class="fas fa-user"></i>–ë–æ–≥–¥–∞–Ω</div>
        <div class="debug-item" onclick="nav('scr-admin')" data-id="scr-admin"><i class="fas fa-shield-alt"></i>–ì–µ–æ—Ä–≥–∏–π</div>
        <div class="debug-item" onclick="nav('scr-brig')" data-id="scr-brig"><i class="fas fa-hard-hat"></i>–ê–±–ª–∞–π</div>
        <div class="debug-item" onclick="nav('scr-worker')" data-id="scr-worker"><i class="fas fa-broom"></i>–í–∞–¥–∏–º</div>
    </div>

</div>

<script>
    // --- DATABASE & PERSISTENCE ---
    const defaultState = {
        orders: [],
        brigades: [
            { id: 1, name: "–ë—Ä–∏–≥–∞–¥–∞ 1 (–ê–±–ª–∞–π)", status: "free" }, // free, busy, away
            { id: 2, name: "–ë—Ä–∏–≥–∞–¥–∞ 2 (–¢–µ–º–∏—Ä–ª–∞–Ω)", status: "busy" },
            { id: 3, name: "–ë—Ä–∏–≥–∞–¥–∞ 3 (–î–∞—É–ª–µ—Ç)", status: "away" }
        ],
        brStep: 0,
        assignments: {}
    };

    let DB = JSON.parse(localStorage.getItem('clean_db_v2')) || defaultState;

    function saveDB() {
        localStorage.setItem('clean_db_v2', JSON.stringify(DB));
        render();
    }

    function resetApp() {
        if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö?')) {
            localStorage.removeItem('clean_db_v2');
            DB = defaultState;
            location.reload();
        }
    }

    // --- NAVIGATION ---
    function nav(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.debug-item').forEach(d => {
            d.classList.toggle('active', d.getAttribute('data-id') === id);
        });
        render();
    }

    function handleAuth() {
        const u = document.getElementById('log-user').value.toLowerCase();
        if(u.includes('admin')) nav('scr-admin');
        else if(u.includes('brig')) nav('scr-brig');
        else nav('scr-client');
    }
    
    function logout() { nav('scr-login'); }

    // --- CLIENT LOGIC ---
    function calcPrice() {
        const type = document.getElementById('c-type').value;
        const srv = document.getElementById('c-srv').value;
        const disp = document.getElementById('c-total');
        const btn = document.querySelector('#btn-order-text span');
        const std = document.getElementById('standard-block');

        if(type === 'CUSTOM') {
            std.style.display = 'none';
            disp.innerText = "–û—Ü–µ–Ω–∫–∞ –∞–¥–º–∏–Ω–æ–º";
            disp.style.fontSize = "22px";
            btn.innerText = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É";
        } else {
            std.style.display = 'block';
            disp.innerText = Math.round(parseInt(type) * parseFloat(srv)).toLocaleString() + " ‚Ç∏";
            disp.style.fontSize = "32px";
            btn.innerText = "–ó–∞–∫–∞–∑–∞—Ç—å";
        }
    }

    function createOrder() {
        const typeSelect = document.getElementById('c-type');
        const order = {
            id: Date.now(),
            addr: document.getElementById('c-addr').value,
            typeName: typeSelect.options[typeSelect.selectedIndex].text,
            price: document.getElementById('c-total').innerText,
            info: document.getElementById('c-info').value,
            isCustom: typeSelect.value === 'CUSTOM',
            status: 'NEW',
            tasks: ['–í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞', '–ú—ã—Ç—å–µ –æ–∫–æ–Ω', '–°–∞–Ω—É–∑–µ–ª', '–í—ã–Ω–æ—Å –º—É—Å–æ—Ä–∞']
        };
        DB.orders.push(order);
        saveDB();
        alert(order.isCustom ? "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –æ—Ü–µ–Ω–∫—É!" : "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!");
    }

    // --- ADMIN LOGIC ---
    function adminAssign(id) {
        const o = DB.orders.find(x => x.id === id);
        
        // –õ–æ–≥–∏–∫–∞ –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
        if(o.isCustom) {
            const p = document.getElementById(`price-${id}`).value;
            if(!p) return alert("–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É!");
            o.price = p + " ‚Ç∏";
            o.isCustom = false; // –¢–µ–ø–µ—Ä—å –æ–Ω —Å—Ç–∞–ª –æ–±—ã—á–Ω—ã–º, –Ω–æ —Å–æ —Å–ø–µ—Ü. —Ü–µ–Ω–æ–π
        }

        o.status = 'ASSIGNED';
        DB.brigades[0].status = 'busy'; // –ó–∞–Ω–∏–º–∞–µ–º –ê–±–ª–∞—è
        DB.brStep = 0;
        saveDB();
        alert("–ë—Ä–∏–≥–∞–¥–∞ –ê–±–ª–∞—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∞!");
    }

    // --- BRIGADIER LOGIC ---
    function brAction(id) {
        const o = DB.orders.find(x => x.id === id);
        if(DB.brStep === 0) { o.status = 'ARRIVED'; DB.brStep = 1; }
        else if(DB.brStep === 1) { o.status = 'IN_WORK'; DB.brStep = 2; }
        else if(DB.brStep === 2) { o.status = 'DONE'; DB.brStep = 3; }
        else if(DB.brStep === 3) { 
            o.status = 'FINISHED'; 
            DB.brStep = 0; 
            DB.brigades[0].status = 'free'; // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ê–±–ª–∞—è
            alert("–û–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã—Ç!"); 
        }
        saveDB();
    }

    function setWorker(task, worker) {
        DB.assignments[task] = worker;
        saveDB();
    }

    function brTab(t) {
        document.getElementById('br-obj-view').style.display = t === 'obj' ? 'block' : 'none';
        document.getElementById('br-prof-view').style.display = t === 'prof' ? 'block' : 'none';
        document.getElementById('t-obj').className = t === 'obj' ? 'tab active' : 'tab';
        document.getElementById('t-prof').className = t === 'prof' ? 'tab active' : 'tab';
    }

    // --- RENDER ENGINE ---
    function render() {
        // CLIENT
        document.getElementById('client-history').innerHTML = DB.orders.map(o => `
            <div class="card" style="padding:15px; border-left:4px solid var(--primary);">
                <div style="font-size:10px; font-weight:800; color:var(--primary); margin-bottom:5px;">${o.status}</div>
                <b>${o.addr}</b><br>
                <small>${o.typeName}</small>
                <div style="margin-top:5px; font-weight:800;">${o.price}</div>
            </div>
        `).join('') || '<div style="text-align:center; color:#b2bec3; padding:20px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>';

        // ADMIN: BRIGADE MONITORING
        document.getElementById('brigades-monitor').innerHTML = DB.brigades.map(b => {
            let color = 'dot-green'; let text = '–°–≤–æ–±–æ–¥–µ–Ω';
            if(b.status === 'busy') { color = 'dot-red'; text = '–ù–∞ –æ–±—ä–µ–∫—Ç–µ'; }
            if(b.status === 'away') { color = 'dot-yellow'; text = '–ü–µ—Ä–µ—Ä—ã–≤'; }
            return `
            <div class="status-row">
                <div style="display:flex; align-items:center;">
                    <div class="status-dot ${color}"></div>
                    <span style="font-weight:600; font-size:13px;">${b.name}</span>
                </div>
                <span style="font-size:10px; font-weight:700; color:${color === 'dot-green' ? 'var(--success)' : (color === 'dot-red' ? 'var(--danger)' : 'var(--warning)')}">
                    ${text}
                </span>
            </div>`;
        }).join('');

        // ADMIN: ORDERS
        const news = DB.orders.filter(o => o.status === 'NEW' || o.status === 'WAITING');
        document.getElementById('admin-orders').innerHTML = news.map(o => `
            <div class="card">
                ${o.isCustom ? '<span style="background:#ff7675; color:white; font-size:10px; padding:3px 8px; border-radius:8px; font-weight:700;">–ù–ï–°–¢–ê–ù–î–ê–†–¢</span>' : ''}
                <div style="margin-top:5px; font-weight:700;">${o.addr}</div>
                <div style="font-size:12px; margin:5px 0; background:#f1f2f6; padding:8px; border-radius:8px;">${o.info || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤'}</div>
                
                ${o.isCustom ? 
                    `<input type="number" id="price-${o.id}" placeholder="–¶–µ–Ω–∞ (‚Ç∏)" style="margin-bottom:10px;">` 
                    : 
                    `<div style="font-weight:800; margin-bottom:10px; color:var(--primary);">${o.price}</div>`
                }
                
                <button class="btn btn-p" style="padding:12px; font-size:13px;" onclick="adminAssign(${o.id})">–ù–∞–∑–Ω–∞—á–∏—Ç—å –ê–±–ª–∞—è</button>
            </div>
        `).join('') || '<div style="text-align:center; color:#b2bec3;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</div>';

        // BRIGADIER
        const active = DB.orders.find(o => o.status !== 'FINISHED' && o.status !== 'NEW');
        const brBox = document.getElementById('br-active-job');
        if(!active) {
            brBox.innerHTML = '<div class="card" style="text-align:center; padding:40px; color:#b2bec3;">–û–∂–∏–¥–∞–π—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è...</div>';
        } else {
            let label = "–ú–´ –ü–†–ò–ë–´–õ–ò";
            let html = `<h3>${active.addr}</h3><p style="color:var(--text-light); font-size:13px;">${active.info}</p>`;
            
            if(DB.brStep === 1) {
                label = "–ù–ê–ß–ê–¢–¨ –†–ê–ë–û–¢–£";
                html += `<hr style="border:0; border-top:1px solid #eee; margin:15px 0;"><label>–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏:</label>`;
                active.tasks.forEach(t => {
                    html += `<div style="margin-bottom:8px; font-size:12px;"><b>${t}</b>
                    <select style="padding:8px; margin-top:4px;" onchange="setWorker('${t}', this.value)">
                        <option>–ù–∞–∑–Ω–∞—á–∏—Ç—å...</option>
                        <option ${DB.assignments[t]==='–í–∞–¥–∏–º'?'selected':''}>–í–∞–¥–∏–º</option>
                        <option ${DB.assignments[t]==='–¢–ª–µ–≥–µ–Ω'?'selected':''}>–¢–ª–µ–≥–µ–Ω</option>
                    </select></div>`;
                });
            } else if(DB.brStep === 2) {
                label = "–ó–ê–í–ï–†–®–ò–¢–¨";
                html += `<div style="background:#e0f2fe; color:#0984e3; padding:15px; border-radius:12px; text-align:center; font-weight:600; margin-top:15px;">–†–∞–±–æ—Ç—ã –≤–µ–¥—É—Ç—Å—è...</div>`;
            } else if(DB.brStep === 3) {
                label = "–°–î–ê–¢–¨ –û–ë–™–ï–ö–¢";
                html += `<div style="border:2px dashed #b2bec3; padding:30px; text-align:center; border-radius:16px; margin-top:15px; color:#b2bec3;"><i class="fas fa-camera" style="font-size:24px;"></i><br>–§–æ—Ç–æ–æ—Ç—á–µ—Ç</div>`;
            }
            brBox.innerHTML = `<div class="card">${html}<button class="btn btn-p" style="margin-top:20px;" onclick="brAction(${active.id})">${label}</button></div>`;
        }

        // WORKER
        const inWork = DB.orders.find(o => o.status === 'IN_WORK');
        const wBox = document.getElementById('worker-tasks');
        if(inWork) {
            let list = "";
            let hasTask = false;
            for(let t in DB.assignments) {
                if(DB.assignments[t] === '–í–∞–¥–∏–º') {
                    hasTask = true;
                    list += `<div class="card" style="display:flex; align-items:center; gap:15px;"><input type="checkbox" style="width:20px; height:20px;"> <b>${t}</b></div>`;
                }
            }
            wBox.innerHTML = hasTask ? list : '<div style="text-align:center; padding:30px; color:#b2bec3;">–í–∞—Å –Ω–µ –Ω–∞–∑–Ω–∞—á–∏–ª–∏ –Ω–∞ –∑–∞–¥–∞—á–∏</div>';
        } else {
            wBox.innerHTML = '<div style="text-align:center; padding:30px; color:#b2bec3;">–ü–æ–∫–∞ –æ—Ç–¥—ã—Ö–∞–µ–º</div>';
        }
    }

    // Init
    calcPrice();
    render();
</script>
</body>
</html>